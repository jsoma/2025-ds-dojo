<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scraping Prompt Without Codegen</title>
    <style>
        body {
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            font-size: 16px;
            padding-bottom: 5em;
        }
        h1, h3, h4 { margin-top: 2em; }
        h2 {
            position: sticky;
            top: 0;
            background: white;
            padding-top: 2em;
            padding-bottom: 0.5em;
            z-index: 100;
            border-bottom: 2px solid #eee;
        }
        /* Give the first h2 (Table of Contents) less top margin */
        h2:first-of-type {
            margin-top: 1em;
            padding-top: 1em;
        }
        h3 a {
            text-decoration: none;
        }
        h3 a:hover {
            text-decoration: underline;
        }
        p {
            margin: 1em 0;
        }
        code { 
            background: #f4f4f4; 
            padding: 2px 4px; 
            border-radius: 3px;
            font-family: Consolas, Monaco, monospace;
        }
        pre { 
            background: #f4f4f4; 
            padding: 1em; 
            border-radius: 5px; 
            overflow-x: auto;
        }
        pre code { background: none; padding: 0; }
        a { color: #0066cc; }
        img {
            display: block;
            max-width: 80%;
            height: auto;
            margin: 1em auto;
            border: solid 1px #999;
        }
        blockquote {
            border-left: solid lightblue 20px;
            margin-left: 4em;
            padding-left: 1em;
            color: #999;
        }
        video {
            display: block;
            max-width: 80%;
            height: auto;
            margin: 1em auto;
            border: solid 1px #999;
        }
        .download-box {
            background: #e8f4f8;
            padding: 1em;
            border-radius: 5px;
            margin: 1em 0;
        }
        ul {
            list-style-type: disc;
            padding-left: 2em;
            margin: 0.5em 0;
        }
        li {
            margin: 0.3em 0;
        }
        .section-header {
            margin-top: 2em;
            margin-bottom: 1em;
            padding-bottom: 0.5em;
            border-bottom: 2px solid #eee;
        }
        .resource-buttons {
            margin: 1em 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5em;
        }
        .resource-button {
            display: inline-block;
            padding: 0.4em 0.8em;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        .resource-button:hover {
            background: #e0e0e0;
            border-color: #ccc;
        }
        .resource-button.primary {
            background: #e3f2fd;
            color: #1565c0;
            border-color: #90caf9;
        }
        .resource-button.primary:hover {
            background: #bbdefb;
            border-color: #64b5f6;
        }
        .resource-button.completed {
            background: #e8f5e9;
            color: #2e7d32;
            border-color: #a5d6a7;
        }
        .resource-button.completed:hover {
            background: #c8e6c9;
            border-color: #81c784;
        }
        .data-download {
            margin: 0.5em 0;
            font-size: 0.9em;
        }
        .download-links {
            margin: 0.5em 0;
            line-height: 1.8;
        }
        .download-links a {
            color: #1976d2;
            text-decoration: none;
        }
        .download-links a:hover {
            text-decoration: underline;
        }
        p:last {
            margin-bottom: 0;
            margin-top: 5em;
        }
    </style>
</head>
<body>
<h1 id="scraping-prompt-without-codegen">Scraping Prompt Without Codegen</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#but-first-windows-people">But first: WINDOWS PEOPLE</a></li>
<li><a href="#an-example">An example?</a></li>
<li><a href="#the-second-prompt">The second prompt</a></li>
<li><a href="#copy-and-paste-the-prompt-below">Copy and paste the prompt below</a></li>
<li><a href="#important-notes">Important Notes: </a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#opening-up-the-browser-and-visiting-our-destination">Opening up the browser and visiting our destination</a></li>
<li><a href="#selecting-an-option-from-a-dropdown">Selecting an option from a dropdown</a></li>
<li><a href="#grab-the-tables-from-the-page">Grab the tables from the page</a></li>
<li><a href="#clicking-next-page-one">Clicking "next page" one</a></li>
<li><a href="#clicking-next-page-until-it-disappears">Clicking "next page" until it disappears</a></li>
<li><a href="#saving-the-results">Saving the results</a></li>
</ul>
<p>Try this prompt in <a href="https://chatgpt.com/">ChatGPT</a> or <a href="https://claude.ai/">Claude</a> to put together a scraper!</p>
<p><strong>This version do NOT use <code>playwright codegen</code></strong></p>
<h2 id="but-first-windows-people">But first: WINDOWS PEOPLE</h2>
<p>Windows and Playwright don't get along very well, so first we'll use this code to install a <em>very specific version</em> of some software to make things work.</p>
<div class="codehilite"><pre><span></span><code><span class="c">%%python -m pip install --quiet &quot;ipykernel==6.28.0&quot;</span>
<span class="n">get_ipython</span><span class="p">().</span><span class="n">kernel</span><span class="p">.</span><span class="n">do_shutdown</span><span class="p">(</span><span class="n">restart</span><span class="p">=</span><span class="n">True</span><span class="p">)</span>
</code></pre></div>

<p>ChatGPT doesn't always remind you to use it, but be sure to put it in the first cell!</p>
<h2 id="an-example">An example?</h2>
<p>If you'd like to try a sample website, search for <strong>Apraisal Companies</strong> at <a href="https://ia-plb.my.site.com/LicenseSearchPage">https://ia-plb.my.site.com/LicenseSearchPage</a></p>
<h2 id="the-second-prompt">The second prompt</h2>
<p>The prompt below usually gives imperfect results. After this prompt gives its final code, add a follow-up to get better code:</p>
<pre class="prompt">
Remember my important notes!
- Use async playwright with async/await
- Do NOT use asyncio
- Flatten the code to not use functions, so the data and df are available in other cells

We are just testing this now. Have it scrape a maximum of 5 pages.
</pre>

<h2 id="copy-and-paste-the-prompt-below">Copy and paste the prompt below</h2>
<pre class="prompt">
I have the following guide about scraping a website. Please adapt it to be for how to scrape a different website.

Proceed in several steps, ONE AT A TIME. Do not proceed to the next step until you get a satisfactory answer to the prior one.

1. Ask what the URL is
2. Ask if there are any forms or fields to be filled out. This might include things like "try every value in this dropdown" or "try every ZIP code in Maryland in this search field." 
3. Confirm the data that needs to be scraped from the page
4. Confirm pagination details
5. Write the guide

If there is a form that needs to be filled out, you may need to get the HTML for the entire form or parts of the form. If necessary a similar walkthrough as below to understand the HTML. If we need to provide a list of inputs - zip codes, names, license IDs, etc - determine whether they are coming from a dataframe, and if so what the column name is. Be sure you know how to submit the form.

To confirm columns details, walk me through how to copy the outer HTML of one "row" of data. I'm new to scraping and might need help. Decide on columns to be saved, then confirm them with me. If it isn't clear, explain what you need from me.

Help me determine the pagination situation. Are there multiple pages of content? Is there a 'next page' button that can be pressed again and again? Do you need to click an incrementing number of pages? Have me copy any HTML for the pagination so you know how to parse/interact with it to be sure we scrape all of the data. Ask if infinite scroll is necessary.

## Important Notes: 

- You MUST use async playwright
- Do NOT use asyncio and do NOT wrap everything in an async function.
- If displaying a dataframe, do NOT use print or ace_tools, just use df.head()
- The sample tutorial reads a table with pd.read_html. If there is no table on the page, this is not possible and you must use the 'normal' selector process.
- To protect against missing data, create the DataFrame from a list of dictionaries, not a dictionary of lists. Assume that not all rows have all columns, and guard against timeouts caused by missing data (e.g. some elements might not have a description).
- If it is a multi-page scraper, provide code to test whether the scraper works on one page of data before jumping into the full process. Ask whether I am satisfied with the result before proceeding.
- Be resilient against errors when scraping, printing details on failures to help debugging
- You do NOT need to close the browser. We can figure that out ourselves.
- Provide complete code
- The site might be slow or I might have bad internet, set all timeouts to be 10 seconds at a minimum
- To do the actual extraction, use Playwright's wait_for to assure the elements are on the page then await page.contents() with BeautifulSoup

GUIDE:

## Installation

We need to install a few tools first! Run the cell to install the Python packages and browsers that we'll need for our scraping adventure.


<div class="codehilite"><pre><span></span><code><span class="c">%%python -m pip install lxml html5lib beautifulsoup4 pandas</span>
<span class="c">%%python -m pip install --quiet playwright</span>
<span class="sx">!playwright install</span>
</code></pre></div>



## Opening up the browser and visiting our destination

Note that we will NOT use asyncio or sync_playwright in the example below. We also do NOT wrap our code in a big async function.


<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">playwright.async_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">async_playwright</span>

<span class="c1"># &quot;Hey, open up a browser&quot;</span>
<span class="n">playwright</span> <span class="o">=</span> <span class="k">await</span> <span class="n">async_playwright</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">browser</span> <span class="o">=</span> <span class="k">await</span> <span class="n">playwright</span><span class="o">.</span><span class="n">chromium</span><span class="o">.</span><span class="n">launch</span><span class="p">(</span><span class="n">headless</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Create a new browser window</span>
<span class="n">page</span> <span class="o">=</span> <span class="k">await</span> <span class="n">browser</span><span class="o">.</span><span class="n">new_page</span><span class="p">()</span>
<span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="s2">&quot;https://newjersey.mylicense.com/verification/Search.aspx&quot;</span><span class="p">)</span>
</code></pre></div>



## Selecting an option from a dropdown

You always start with await page.locator("select").select_option("whatever option you want"). You'll probably get an error because there are multiple dropdowns on the page, but Playwright doesn't know which one you want to use! Just read the error and figure out the right one.


<div class="codehilite"><pre><span></span><code><span class="gh">#</span> await page.locator(&quot;select&quot;).select_option(&quot;Acupuncture&quot;)
await page.locator(&quot;#t_web_lookup__profession_name&quot;).select_option(&quot;Perfusionist&quot;)
</code></pre></div>



Click the submit button.


<div class="codehilite"><pre><span></span><code><span class="gh">#</span> await page.get_by_text(&quot;Search&quot;).click()
await page.get_by_role(&quot;button&quot;, name=&quot;Search&quot;).click()
</code></pre></div>



## Grab the tables from the page

Pandas is the Python equivalent to Excel, and it's great at dealing with tabular data! Often the data on a web page that looks like a spreadsheet can be read with pd.read_html.

You use await page.content() to save the contents of the page, then feed it to read_html to find the tables. len(tables) checks the number of tables you have, then you manually poke around to see which one is the one you're interested in. tables[0] is the first one, tables[1] is the second one, and so on...


<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>

<span class="n">html</span> <span class="o">=</span> <span class="k">await</span> <span class="n">page</span><span class="o">.</span><span class="n">content</span><span class="p">()</span>
<span class="n">tables</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
<span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>



## Clicking "next page" one

Just like using a dropdown, select box or button, we'll use page.get_by_text to try to select the button.

We add timeout=10000 to wait 5 seconds before confirming it isn't there.


<div class="codehilite"><pre><span></span><code><span class="gh">#</span> page.get_by_text(&quot;Next Page&quot;).click()
await page.locator(&quot;a:has-text(&#39;Next Page&#39;)&quot;).click(timeout=10000)
</code></pre></div>



## Clicking "next page" until it disappears

Eventually the "next page" link disappears, and Python starts screaming. We use try/except down below to say "don't worry little baby, it's okay, we'll just finish up if the button is gone."


<div class="codehilite"><pre><span></span><code><span class="gh">#</span> all of our data will end up going here
all_data = pd.DataFrame()

while True:
    await page.wait_for_selector(&quot;table&quot;)

    # Get all of the tables on the page
    html = await page.content()
    tables = pd.read_html(StringIO(html))

    # Get the table (and edit if necessary)
    df = tables[0]

    # Add the tables on this page to the big list of stuff
    all_data = pd.concat([all_data, df], ignore_index = True)
    try:
        await page.locator(&quot;a:has-text(&#39;Next Page&#39;)&quot;).click(timeout=5000)
    except:
        break
all_data
</code></pre></div>



## Saving the results

Now we'll save it to a CSV file! Easy peasy.


<div class="codehilite"><pre><span></span><code>all_data.to_csv(&quot;output.csv&quot;, index=False)
</code></pre></div>


</pre>
</body>
</html>